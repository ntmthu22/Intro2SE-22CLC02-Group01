<%- include('../includes/general/head.ejs') %>
  <style>
    .file-upload {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      transition: border-color 0.3s;
      cursor: pointer;
    }
    .file-upload.dragover {
      border-color: #007bff;
    }
    .file-upload img {
      max-width: 50px;
      margin-bottom: 10px;
    }
    .file-upload p {
      font-family: sans-serif;
      margin: 0;
    }
    .output-section {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      height: 100%;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <%- include('../includes/general/navbar.ejs') %>
  <section class="container py-5">
    <div class="row">
      <!-- Input Section -->
      <div class="col-md-6">
        <form
          action="/<%= user.role %>/generate"
          method="POST"
          enctype="multipart/form-data"
        >
          <!-- <div class="file-upload">
            <img
              src="https://img.icons8.com/material-outlined/24/000000/upload.png"
              alt="Upload"
            />
            <p>Drop Image Here<br />- or -<br />Click to Upload</p>
            <input
              type="file"
              id="fileInput"
              name="uploadedImage"
              class="form-control-file d-none"
              accept="image/*"
            />
          </div> -->
          <div class="form-group">
            <label class="form-label" for="myfile">Select a file:</label>
            <input type="file" class="form-control=file" id="myfile" name="myfile">
          </div>

          <% if (user.membershipType === 'Premium') { %>
          <div class="form-group">
            <label for="promptInput">prompt</label>
            <textarea class="form-control" id="promptInput" name="promptInput" rows="2" placeholder="Describe how you want your 3D object to be"></textarea>
          </div>

          <div class="form-group">
            <label for="negativePromptInput">negative prompt</label>
            <textarea class="form-control" id="negativePromptInput" name="negativePromptInput" rows="2" placeholder="Enter negative characteristics of your 3D object">ugly, blurry, pixelated obscure, unnatural colors, poor lighting, dull, unclear, cropped, lowres, low quality, artifacts, duplicate</textarea>
          </div>

          <div class="form-group">
            <label for="elevation" class="form-label">elevation (<span class="text-muted" id="elevationValue">0</span>)</label>
            <input type="range" class="form-range w-100" min="-90" max="90" value="0" id="elevation" name="elevation" oninput="updateValue('elevationValue', this.value)">
          </div>
          
          <div class="form-group">
            <label for="inference-steps" class="form-label">inference steps (<span class="text-muted" id="inferenceStepsValue">30</span>)</label>
            <input type="range" class="form-range w-100" min="1" max="100" value="30" id="inference-steps" name="inferenceSteps" oninput="updateValue('inferenceStepsValue', this.value)">
          </div>
          
          <div class="form-group">
            <label for="random-seed" class="form-label">random seed (<span class="text-muted" id="randomSeedValue">0</span>)</label>
            <input type="range" class="form-range w-100" min="0" max="100000" value="0" id="random-seed" name="randomSeed" oninput="updateValue('randomSeedValue', this.value)">
          </div>
          <% } %>
          
          <button type="submit" class="btn btn-primary btn-block mt-3 mb-0">
            Generate
          </button>

          <button id="loadingButton" class="btn btn-primary btn-block mt-3 mb-0 d-none" type="button" disabled>
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Loading...
          </button>

          <% if (user.membershipType === 'Free') { %>
          <div class="alert alert-warning alert-dismissible fade show mt-3 mb-0" role="alert">
            Upgrade account to gain access to exclusive features like <strong>Prompt Input</strong> and enjoy <strong>unlimited tries</strong>.
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <% } %>
        </form>
      </div>
      <!-- Output Section -->
      <div class="col-md-6">
        <div class="output-section">
          <video class="w-100" controls>
            <source src="https://ashawkey-lgm.hf.space/file=/tmp/gradio/02de6646e532460bde325d015d289d22bc557a4c/gradio_output.mp4" type="video/mp4">
            <source src="movie.ogg" type="video/ogg">
            Your browser does not support the video tag.
          </video>
          <p class="mb-0 p-0">Download your .ply file <a href="https://ashawkey-lgm.hf.space/file=/tmp/gradio/7d6a10158085dfc67582985f82485616b61d4516/gradio_output.ply">here</a></p>
        </div>
      </div>
    </div>
  </section>

  <script>
    function updateValue(spanId, value) {
      document.getElementById(spanId).textContent = value;
    }
    const submitButton = document.querySelector('button.btn[type="submit"]');
    const loadingButton = document.getElementById('loadingButton');
    submitButton.addEventListener('click', function() {
      submitButton.classList.add('d-none');
      loadingButton.classList.remove('d-none');
    })
    /* const fileUpload = document.querySelector(".file-upload");
    const fileInput = document.getElementById("fileInput");

    fileUpload.addEventListener("click", () => fileInput.click());

    fileUpload.addEventListener("dragover", (e) => {
      e.preventDefault();
      fileUpload.classList.add("dragover");
    });

    fileUpload.addEventListener("dragleave", () => {
      fileUpload.classList.remove("dragover");
    });

    fileUpload.addEventListener("drop", (e) => {
      e.preventDefault();
      fileUpload.classList.remove("dragover");
      const files = e.dataTransfer.files;
      fileInput.files = files;
      console.log(files);
    });

    fileInput.addEventListener("change", (e) => {
      const files = e.target.files;
      console.log(files);
    }); */
  </script>
</body>
</html>
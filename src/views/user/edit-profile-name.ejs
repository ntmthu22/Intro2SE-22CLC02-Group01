<%- include('../includes/general/head.ejs') %>
</head>
  <body>
    <%- include('../includes/general/navbar.ejs') %>
    
    <section class="container py-5 d-flex align-items-center justify-content-center">
      <div class="card position-relative" style="width: 24rem;">

        <a href="/<%= user.role %>/edit-profile" class="position-absolute" style="top:5px;left:5px;background:none;border:none">
          <%- include('../icons/arrow_left.svg') %>
        </a>
        
        <form class="pt-5 p-3" action="/<%= user.role %>/edit-profile/name" method="POST">
          <div class="form-group">
            <label for="name">Name</label>
            <input type="hidden" id="originalName" value="<%= originalName %>">
            <input type="text" class="form-control
            <%= validationErrors.find(e => e.path === 'name') ? 'is-invalid' : '' %>" name="name" id="name" aria-describedby="nameHelp" value="<%= user.name %>" placeholder="Enter new name">
            <small id="nameHelp" class="form-text text-muted"><%= errorMessage ? errorMessage : 'A name that makes sense would be nice.' %></small>
          </div>
          <button type="submit" disabled class="btn btn-primary btn-lg btn-block">Submit</button>
        </form>
      </div>
    </section>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const nameInput = document.getElementById('name');
        const originalName = document.getElementById('originalName');
        const submitButton = document.querySelector('button.btn[type="submit"]');
        
        const initialValue = originalName.value;
        
        nameInput.addEventListener('input', () => {
          nameInput.classList.remove('is-invalid');
          if (nameInput.value.trim() !== initialValue.trim()) {
            submitButton.disabled = false;
          } else {
            submitButton.disabled = true;
          }
        });

        submitButton.addEventListener('click', (e) => {
          if (nameInput.value.trim() === '') {
            document.getElementById('nameHelp').innerText = "Your name shouldn't be blank.";
            e.preventDefault();
            nameInput.classList.add('is-invalid');
          }
        })
      });
    </script>
  </body>
</html>
